<?xml version="1.0"?>
<Grammar rootTag="root" startRule="start">
	<Sequence name="start" >
		<Choice failSafe="true">
			<Assignment tagName="noinclude" tag="(?=.*(&lt;onlyinclude>))" regex="true">
				<Reference name="endText" />
			</Assignment>
			<Reference name="heading" />
		</Choice>
		<Reference name="main" />
	</Sequence>
	<Text name="main">
		<Reference name="newLine" />
		<Assignment tagName="link" tag="[[">
			<Reference name="endText" var="]]" />
		</Assignment>
		<Assignment tagName="tplarg" tag="{{{(?!{)" regex="true">
			<Reference name="tplSeq" var="}}}" />
		</Assignment>
		<Assignment tagName="template" tag="{{">
			<Reference name="tplSeq" var="}}" />
		</Assignment>
		<Reference name="comment" />
		<Assignment tagName="onlyinclude" tag="&lt;/onlyinclude>">
			<Sequence>
				<Reference name="main" />
				<Choice failSafe="true">
					<Assignment tagName="endtag" tag="&lt;onlyinclude>" />
				</Choice>
			</Sequence>
		</Assignment>
		<Assignment tagName="xmltag" tag="&lt;(?=(\w+)[\s\/>])" regex="true">
			<Sequence>
				<Assignment tagName="name" tag="~r">
				<Choice failSafe="true">
					<Assignment tagName="attr" tag="\s+" regex="true">
						<Reference name="main" />
					</Assignment>
				</Choice>
				<Choice>
					<Assignment tagName="endtag" tag="/>" />
					<Assignment tagName="inner" tag=">">
						<Reference name="endText" var="&lt;/~r>" />
					</Assignment>
				</Choice>
			</Sequence>
		</Assignment>
	</Text>
	<Sequence name="endText">
		<Reference name="main" />
		<Assignment tagName="endtag" tag="~r" />
	</Sequence>
	<Choice name="ignoreList" failSafe="true">
		<Sequence>
			<Choice>
				<Assignment name="whitespace" tag="[ \t]+" regex="true" />
				<Reference name="comment" />
			</Choice>
			<Reference name="ignoreList" />
		</Sequence>
	</Choice>
	<Assignment name="newLine" tag="\n">
		<Choice failSafe="true">
			<Reference name="heading" />
		</Choice>
	</Assignment>
	<Sequence name="heading">
		<Assignment tagName="h" tag="(={1,6})" regex="true">
			<Reference name="endText" />
		</Assignment>
		<Reference name="ignoreList" />
		<Reference name="newLine" />
	</Sequence>
	<Sequence name="tplSeq">
		<Assignment tagName="title">
			<Reference name="main" />
		</Assignment>
		<Reference name="partList" />
		<Assignment tagName="endtag" tag="~r" />
	</Sequence>
	<Choice name="partList" failSafe="true">
		<Sequence>
			<Assignment tagName="part" tag="|">
				<Sequence>
					<Assignment tagName="first">
						<Reference name="main" />
					</Assignment>
					<Choice failSafe="true">
						<Assignment tagName="value" tag="=">
							<Reference name="main" />
						</Assignment>
					</Choice>
				</Sequence>
			</Assignment>
			<Reference name="partList" />
		</Sequence>
	</Choice>
	<Assignment name="comment" tagName="comment" tag="&lt;!--.*?(?:-->|$)" regex="true" />
</Grammar>
